@model rasp.Controllers.ScheduleViewModel 
@using System.Globalization

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Расписание занятий</title>
    <link rel="stylesheet" href="~/css/schedule.css" asp-append-version="true" />

</head>
<body>
    <div class="controls">
        <button id="editBtn">Редактировать</button>
        <button id="saveBtn">Сохранить</button>
        <button id="addBtn">Добавить</button>
    </div>

    <h1 class="page-title">Расписание занятий</h1>

    <div class="filters">
        <div class="filter">
            <label for="dayFilter">День недели:</label>
            <select id="dayFilter">
                <option value="all">Все</option>
                @foreach (var day in Model.Days)
                {
                    <option value="@day">@day</option>
                }
            </select>
        </div>
        <div class="filter">
            <label for="groupFilter">Группа:</label>
            <select id="groupFilter">
                <option value="all">Все</option>
                @foreach (var grp in Model.Groups)
                {
                    <option value="@grp">@grp</option>
                }
            </select>
        </div>
    </div>

    <div id="scheduleContainer">
        @foreach (var day in Model.Days)
        {
            <div class="day-section" data-day="@day">
                <h2 class="day-title">@day</h2>
                <div class="grid-container">
                    @foreach (var grpRec in Model.Data)
                    {
                        var grpName = grpRec.GroupRecord.Name;
                        <div class="group-card" data-group="@grpName">
                            <span class="remove-day" title="Удалить">×</span>

                            <h3 class="group-title">Группа @grpName</h3>
                            <div class="classes-list">
                                @foreach (var dr in grpRec.Records.Where(r =>
                               r.Date.ToString("dddd", new CultureInfo("ru-RU")) == day))
                                {
                                    @foreach (var cls in dr.SingleRecords)
                                    {
                                        <div class="class-item">
                                            <div class="class-main">
                                                <span class="time">№@cls.Number</span>
                                                <span class="subject">@cls.Discipline.DisciplineCode</span>
                                                <span class="separator">|</span>
                                                <span class="place">@cls.Place.PlaceName</span>
                                            </div>
                                            <div class="class-teacher">@cls.Teacher.Name</div>
                                        </div>
                                    }
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
    </div>


    <dialog id="addDialog">
        <div class="dialog-header">Добавить расписание на один день</div>
        <div class="dialog-body">
            <form id="addForm" action='@Url.Action("AddDaySchedule","RaspisAdmin")' method="post">
                <label for="lessonDate">Дата</label>
                <input type="date" id="lessonDate" name="Date" required />
                <div id="dayOfWeekDisplay" style="margin-top: 6px; font-weight: 500; color: #444;"></div>

                <label for="lessonGroup">Группа</label>
                <select id="lessonGroup" name="GroupName" required>
                    @foreach (var g in Model.Groups)
                    {
                        <option value="@g">@g</option>
                    }
                </select>

                <!-- Контейнер для строк с парами -->
                <div id="lessonsContainer">
                    <!-- Первая строка пар по умолчанию -->
                    <div class="lesson-row">
                        <div>
                            <label>№ пары</label>
                            <input type="number" name="Lessons[0].Number" min="1" max="10" value="1" required readonly />
                        </div>
                        <div>
                            <label>Дисциплина</label>
                            <input type="text" name="Lessons[0].DisciplineCode" required />
                        </div>
                        <div>
                            <label>Аудитория</label>
                            <input type="text" name="Lessons[0].PlaceName" required />
                        </div>
                        <div>
                            <label>Преподаватель</label>
                            <input type="text" name="Lessons[0].TeacherName" required />
                        </div>
                        <button type="button" class="delete-row-btn">×</button>
                    </div>
                </div>

                <button type="button" class="add-row-btn" id="addLessonRow">+ Добавить пару</button>
            </form>
        </div>
        <div class="dialog-footer">
            <button type="submit" form="addForm">OK</button>
            <button type="button" id="cancelAdd">Cancel</button>
        </div>
    </dialog>

    <script src="~/js/schedule.js" asp-append-version="true"></script>

</body>
</html>
